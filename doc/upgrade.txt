##############################################################################
# RackMonkey - Know Your Racks - http://www.rackmonkey.org                   #
# Version 1.2.%BUILD%                                                        #
# (C)2004-2009 Will Green (wgreen at users.sourceforge.net)                  #
# RackMonkey v1.2.5 Upgrade Guide                                            #
##############################################################################

You can read the latest version of this document in HTML format at:
http://www.rackmonkey.org/doc/1.2.5

The upgrade guide for v1.2.5 is still being written. Should separate the file
into two, one from v1.2.4 and one from earlier releases.


Upgrading RackMonkey
====================
RackMonkey v1.2.x can be upgraded to the latest version following the
instructions below. NB. Upgrading from v1.1 is not supported.

Upgrading from earlier releases of v1.2 is straightforward: but there is a
schema change in this release. Users coming from v1.2.3 or earlier should also
note that there has been a change in the way configuration is stored, which is 
explained in the instructions below.

Please ensure you take a full backup of the RackMonkey database before
upgrading. For SQLite you can do this by copying the DB file, for other
databases please refer to their respective documentation. 

Please note that the $ or # shown at the start of commands represents the 
shell prompt, you should not type it.

Schema Upgrade
--------------

Changes from v1.2.4
-------------------
Added column to support numbering of racks from top as well as bottom.

Changes from v1.2.3
-------------------
The Postgres and MySQL schemas has been tweaked in v1.2.4 to prevent NULL 
values being stored in columns which are foreign key constraints. 


Rackmonkey Files
----------------
Once you have obtained a copy of RackMonkey (see README) you should have a 
directory with the following layout:

  conf	      Includes RackMonkey and Apache configuration files
  doc         Documentation for RackMonkey
  README      Read this before you start
  perl        Contains the perl scripts and modules
  sql         SQL to create the RackMonkey database
  tmpl        HTML::Template files for the web interface
  www         Web space files, e.g. images, css files


Creating a v1.2.4 Configuration
-------------------------------
RackMonkey now uses a text file to store configuration information, such as 
the database to use. Before upgrading you should take a backup of 
RackMonkey/Conf.pm as this file is totally replaced with a new module. You 
should now copy conf/rackmonkey.conf-default to conf/rackmonkey.conf then use 
your existing RackMonky/Conf.pm module to fill in the values. 

Comments in the configuration file are included with the a #. Comments must
either start a line or be preceded by whitespace. Values in the configuration
file cannot include spaces and configuration variables are lower case:

	Right: wwwpath = /rackmonkey/www
	Wrong: WWWPATH = /rackmonkey system/www

By default this file is read from /etc/rackmonkey.conf, if you're happy to put
it there, simply copy your conf/rackmonkey.conf to /etc/rackmonkey.conf. If 
you want to put this file in a different location you need to tell RackMonkey 
where to look by using an environment variable. If you're using Apache you 
should do this by adding the following line to your httpd.conf:

	SetEnv RACKMONKEY_CONF /<path>/rackmonkey.conf
	
Replacing <path> with wherever you put the rackmonkey.conf. You should then 
get apache to reload its configuration.

On Debian and Ubuntu:
	# /etc/init.d/apache2 force-reload

On Red Hat based Linux systems (including CentOS and RHEL):
	# service httpd reload
	
On Mac OS X 10.5 (Leopard):
 	$ sudo apachectl graceful

On NetBSD:
	# /etc/rc.d/apache reload
	
On other systems kill -HUP <apache_pid> will do the trick.

You're now ready to upgrade your install.

Performing the Upgrade
----------------------
* Upgrade Templates: delete all the existing templates and copy the new
  templates (from the tmpl directory) into the existing template directory.

* Upgrade web content: delete all the existing web (www) content and copy the 
  new content into the existing directory (maintaining the layout).

* Upgrade docs: delete all the existing docs and copy the new content into
  the existing docs with the new versions.

* Upgrade code: delete the contents of the perl/RackMonkey directory then copy
  the new perl/RackMonkey modules into the directory. Replace the copy of
  bin/logdump with the new one. Finally, copy the new rackmonkey.pl script
  over the existing one.

NB. If running RackMonkey under mod_perl you must restart or HUP your mod_perl 
instance. This ensures mod_perl reads the new modules.

The upgrade is now complete and the updated RackMonkey is ready to use. If you
experience any problems with the upgrade you should consult
doc/troubleshooting.txt. 